From f87ab46e185105d2593272e8535a13ee188eca8c Mon Sep 17 00:00:00 2001
From: Wenli Looi <wlooi@ucalgary.ca>
Date: Sat, 1 Jul 2023 17:37:17 +0000
Subject: [PATCH 1/3] build: add ALT5 vendor/model/variant

This allows adding another device variant.

Signed-off-by: Wenli Looi <wlooi@ucalgary.ca>
---
 include/image.mk               | 21 ++++++++++++++++++++-
 scripts/json_add_image_info.py |  2 +-
 2 files changed, 21 insertions(+), 2 deletions(-)

diff --git a/include/image.mk b/include/image.mk
index 62e05b2567..9736e4e164 100644
--- a/include/image.mk
+++ b/include/image.mk
@@ -357,6 +357,7 @@ define Device/InitProfile
   DEVICE_ALT2_TITLE = $$(DEVICE_ALT2_VENDOR) $$(DEVICE_ALT2_MODEL)$$(if $$(DEVICE_ALT2_VARIANT), $$(DEVICE_ALT2_VARIANT))
   DEVICE_ALT3_TITLE = $$(DEVICE_ALT3_VENDOR) $$(DEVICE_ALT3_MODEL)$$(if $$(DEVICE_ALT3_VARIANT), $$(DEVICE_ALT3_VARIANT))
   DEVICE_ALT4_TITLE = $$(DEVICE_ALT4_VENDOR) $$(DEVICE_ALT4_MODEL)$$(if $$(DEVICE_ALT4_VARIANT), $$(DEVICE_ALT4_VARIANT))
+  DEVICE_ALT5_TITLE = $$(DEVICE_ALT5_VENDOR) $$(DEVICE_ALT5_MODEL)$$(if $$(DEVICE_ALT5_VARIANT), $$(DEVICE_ALT5_VARIANT))
   DEVICE_VENDOR :=
   DEVICE_MODEL :=
   DEVICE_VARIANT :=
@@ -375,6 +376,9 @@ define Device/InitProfile
   DEVICE_ALT4_VENDOR :=
   DEVICE_ALT4_MODEL :=
   DEVICE_ALT4_VARIANT :=
+  DEVICE_ALT5_VENDOR :=
+  DEVICE_ALT5_MODEL :=
+  DEVICE_ALT5_VARIANT :=
   DEVICE_PACKAGES :=
   DEVICE_DESCRIPTION = Build firmware images for $$(DEVICE_TITLE)
 endef
@@ -459,7 +463,8 @@ DEFAULT_DEVICE_VARS := \
   DEVICE_ALT1_VENDOR DEVICE_ALT1_MODEL DEVICE_ALT1_VARIANT \
   DEVICE_ALT2_VENDOR DEVICE_ALT2_MODEL DEVICE_ALT2_VARIANT \
   DEVICE_ALT3_VENDOR DEVICE_ALT3_MODEL DEVICE_ALT3_VARIANT \
-  DEVICE_ALT4_VENDOR DEVICE_ALT4_MODEL DEVICE_ALT4_VARIANT
+  DEVICE_ALT4_VENDOR DEVICE_ALT4_MODEL DEVICE_ALT4_VARIANT \
+  DEVICE_ALT5_VENDOR DEVICE_ALT5_MODEL DEVICE_ALT5_VARIANT
 
 define Device/ExportVar
   $(1) : $(2):=$$($(2))
@@ -557,6 +562,9 @@ define Device/Build/initramfs
 	DEVICE_ALT4_VENDOR="$$(DEVICE_ALT4_VENDOR)" \
 	DEVICE_ALT4_MODEL="$$(DEVICE_ALT4_MODEL)" \
 	DEVICE_ALT4_VARIANT="$$(DEVICE_ALT4_VARIANT)" \
+	DEVICE_ALT5_VENDOR="$$(DEVICE_ALT5_VENDOR)" \
+	DEVICE_ALT5_MODEL="$$(DEVICE_ALT5_MODEL)" \
+	DEVICE_ALT5_VARIANT="$$(DEVICE_ALT5_VARIANT)" \
 	DEVICE_TITLE="$$(DEVICE_TITLE)" \
 	DEVICE_PACKAGES="$$(DEVICE_PACKAGES)" \
 	TARGET="$(BOARD)" \
@@ -688,6 +696,9 @@ define Device/Build/image
 	DEVICE_ALT4_VENDOR="$(DEVICE_ALT4_VENDOR)" \
 	DEVICE_ALT4_MODEL="$(DEVICE_ALT4_MODEL)" \
 	DEVICE_ALT4_VARIANT="$(DEVICE_ALT4_VARIANT)" \
+	DEVICE_ALT5_VENDOR="$(DEVICE_ALT5_VENDOR)" \
+	DEVICE_ALT5_MODEL="$(DEVICE_ALT5_MODEL)" \
+	DEVICE_ALT5_VARIANT="$(DEVICE_ALT5_VARIANT)" \
 	DEVICE_TITLE="$(DEVICE_TITLE)" \
 	DEVICE_PACKAGES="$(DEVICE_PACKAGES)" \
 	TARGET="$(BOARD)" \
@@ -739,6 +750,9 @@ define Device/Build/artifact
 	DEVICE_ALT4_VENDOR="$(DEVICE_ALT4_VENDOR)" \
 	DEVICE_ALT4_MODEL="$(DEVICE_ALT4_MODEL)" \
 	DEVICE_ALT4_VARIANT="$(DEVICE_ALT4_VARIANT)" \
+	DEVICE_ALT5_VENDOR="$(DEVICE_ALT5_VENDOR)" \
+	DEVICE_ALT5_MODEL="$(DEVICE_ALT5_MODEL)" \
+	DEVICE_ALT5_VARIANT="$(DEVICE_ALT5_VARIANT)" \
 	DEVICE_TITLE="$(DEVICE_TITLE)" \
 	DEVICE_PACKAGES="$(DEVICE_PACKAGES)" \
 	TARGET="$(BOARD)" \
@@ -782,6 +796,7 @@ $(if $(strip $(DEVICE_ALT1_TITLE)),- $(DEVICE_ALT1_TITLE))
 $(if $(strip $(DEVICE_ALT2_TITLE)),- $(DEVICE_ALT2_TITLE))
 $(if $(strip $(DEVICE_ALT3_TITLE)),- $(DEVICE_ALT3_TITLE))
 $(if $(strip $(DEVICE_ALT4_TITLE)),- $(DEVICE_ALT4_TITLE))
+$(if $(strip $(DEVICE_ALT5_TITLE)),- $(DEVICE_ALT5_TITLE))
 @@
 
 endef
@@ -807,6 +822,10 @@ ifneq ($$(strip $$(DEVICE_ALT4_TITLE)),)
 DEVICE_DISPLAY = $$(DEVICE_ALT4_TITLE) ($$(DEVICE_TITLE))
 $$(info $$(call Device/DumpInfo,$(1)))
 endif
+ifneq ($$(strip $$(DEVICE_ALT5_TITLE)),)
+DEVICE_DISPLAY = $$(DEVICE_ALT5_TITLE) ($$(DEVICE_TITLE))
+$$(info $$(call Device/DumpInfo,$(1)))
+endif
 DEVICE_DISPLAY = $$(DEVICE_TITLE)
 $$(eval $$(if $$(DEVICE_TITLE),$$(info $$(call Device/DumpInfo,$(1)))))
 endef
diff --git a/scripts/json_add_image_info.py b/scripts/json_add_image_info.py
index aded743bcc..915e5f6181 100755
--- a/scripts/json_add_image_info.py
+++ b/scripts/json_add_image_info.py
@@ -20,7 +20,7 @@ if not file_path.is_file():
 
 def get_titles():
     titles = []
-    for prefix in ["", "ALT0_", "ALT1_", "ALT2_", "ALT3_", "ALT4_"]:
+    for prefix in ["", "ALT0_", "ALT1_", "ALT2_", "ALT3_", "ALT4_", "ALT5_"]:
         title = {}
         for var in ["vendor", "model", "variant"]:
             if getenv("DEVICE_{}{}".format(prefix, var.upper())):
-- 
2.51.1

